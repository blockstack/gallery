"use strict";angular.module("profileviewerApp",["ngCookies","ngResource","ngRoute","ui.bootstrap"]).config(["$compileProvider","$locationProvider","$routeProvider",function(a,b,c){a.aHrefSanitizationWhitelist(/^\s*(https?|file|tel|bitcoin|skype|mailto|callto|bitmsg):/),b.html5Mode(!0).hashPrefix("!"),c.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/:username",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("profileviewerApp").factory("Utils",[function(){var a={};return a.hasProp=function(a){for(var b=[].slice.call(arguments,1);a&&b.length;)a=a[b.shift()];return b.length?null:a},a.getProp=function(a){for(var b=[].slice.call(arguments,1);a&&b.length;)a=a[b.shift()];return b.length?null:a},a.loadAvatar=function(a,b,c){var d=new Image;d.onload=function(){if(document.getElementById(b).appendChild(d),d.height<d.width){d.style.height="100%",d.style.width="auto";var a=-(c/d.height*d.width-c)/2;d.style.marginLeft=a.toString()+"px"}},d.src=a},a}]),angular.module("profileviewerApp").factory("Person",["$http","Utils",function(a,b){var c={},d=b.hasProp;return c.findByUsername=function(b,c,e){var f="http://onenameapi.herokuapp.com/users/"+b;a({method:"GET",url:f}).success(function(b){d(b,"graph","url")?a({method:"GET",url:b.graph.url}).success(function(a){b.graph=a,c(b)}).error(function(a){console.log(a)}):(b.graph={},c(b))}).error(function(a){e(a)})},c.search=function(b,c,d){if(b){if(0===b.length)return void c({results:[]});var e="http://onenameapi.herokuapp.com/search?query="+b;a({method:"GET",url:e}).success(function(a){c(a)}).error(function(a){d(a)})}},c}]),angular.module("profileviewerApp").factory("Samples",[function(){var a={};return a.user=function(){var a={username:"ryanshea",name:"Ryan Shea",contactMethods:[{type:"email",identifier:"ryan@shea.io",iconClass:"fa-envelope-o",url:"#"},{type:"phone",identifier:"5515563914",iconClass:"fa-mobile-phone",url:"#"},{type:"skype",identifier:"ryaneshea",iconClass:"fa-skype",url:"skype:ryaneshea"},{type:"bitmessage",identifier:"BM-2cSqtKVx27J8FZunKqjcsbfKQAhbgWnLdg",url:"bitmsg:BM-2cSqtKVx27J8FZunKqjcsbfKQAhbgWnLdg"}],avatarUrl:"https://s3.amazonaws.com/97p/tux.jpg",backgroundUrl:"https://s3.amazonaws.com/dx3/ryanshea",location:"New York, NY",bio:"Co-founder of OneName with @Muneeb. Bitcoin, identity, the blockchain, and decentralization.",featuredFriends:[{username:"muneeb",avatarUrl:"https://s3.amazonaws.com/kd4/muneeb"},{username:"albertwenger",avatarUrl:"https://pbs.twimg.com/profile_images/1773890030/aew_artistic_bigger.gif"},{username:"naval",avatarUrl:"https://pbs.twimg.com/profile_images/3696617328/667874c5936764d93d56ccc76a2bcc13.jpeg"},{username:"arianna",avatarUrl:"https://s3.amazonaws.com/97p/ariannas-profile.jpg"}],unfeaturedFriendCount:24,shortPgpFingerprint:"A93E A312",shortOtrFingerprint:"756C E84F",payments:[{type:"bitcoin",identifier:"14eautXfJT7EZsKfm1eHSAPnHkn3w1XF9R"}],profiles:[{type:"twitter",iconClass:"fa-twitter",username:"ryaneshea",url:"https://twitter.com/ryaneshea",proofUrl:"https://twitter.com/ryaneshea/status/486057647808868352"},{type:"facebook",iconClass:"fa-facebook",username:"ryaneshea",url:"https://facebook.com/ryaneshea",proofUrl:"https://facebook.com/ryaneshea/posts/10152385985597713"},{type:"github",iconClass:"fa-github",username:"rxl",url:"https://github.com/rxl",proofUrl:"https://gist.github.com/rxl/9799732"},{type:"linkedin",iconClass:"fa-linkedin",username:"ryaneshea",url:"https://www.linkedin.com/in/ryaneshea",proofUrl:"https://www.linkedin.com"},{type:"instagram",iconClass:"fa-instagram",username:"ryaneshea",url:"http://instagram.com/ryaneshea",proofUrl:"http://instagram.com/ryaneshea"},{type:"reddit",iconClass:"fa-reddit",username:"ryaneshea",url:"http://www.reddit.com/user/ryaneshea/",proofUrl:"http://www.reddit.com/user/ryaneshea/"},{type:"hackernews",iconClass:"fa-hacker-news",username:"rxl",url:"https://news.ycombinator.com/user?id=rxl",proofUrl:"https://news.ycombinator.com/user?id=rxl"},{type:"stackoverflow",iconClass:"fa-stack-overflow",username:"/users/1530754/ryan",url:"http://stackoverflow.com/users/1530754/ryan",proofUrl:"http://stackoverflow.com/users/1530754/ryan"},{type:"angellist",iconClass:"fa-angellist",username:"ryanshea",url:"https://angel.co/ryanshea",proofUrl:"https://angel.co/ryanshea"},{type:"googleplus",iconClass:"fa-google-plus",username:"Ryan Shea",url:"https://plus.google.com/110166845166458482181/posts",proofUrl:"https://plus.google.com/110166845166458482181/posts"}],websites:[{type:"website dark-gradient",iconClass:"fa-link",username:"shea.io",url:"http://shea.io",proofUrl:"http://shea.io/.well-known/openname.txt"},{type:"website dark-gradient",iconClass:"fa-link",username:"onename.io",url:"https://onename.io",proofUrl:"https://onename.io/.well-known/openname.txt"}]};return a},a}]),angular.module("profileviewerApp").directive("typeahead",["$timeout",function(a){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"views/_searchbar.html",scope:{search:"&",select:"&",items:"=",term:"=",timeout:"@",placeholder:"@"},controller:["$scope",function(a){a.items=[],a.hide=!1,this.activate=function(b){a.active=b},this.activateNextItem=function(){var b=a.items.indexOf(a.active);this.activate(a.items[(b+1)%a.items.length])},this.activatePreviousItem=function(){var b=a.items.indexOf(a.active);this.activate(a.items[0===b?a.items.length-1:b-1])},this.isActive=function(b){return a.active===b},this.selectActive=function(){this.select(a.active)},this.select=function(){},a.isVisible=function(){return!a.hide&&(a.focused||a.mousedOver)}}],link:function(b,c,d,e){var f=c.find("form"),g=f.find("input"),h=c.find("> div");g.bind("focus",function(){b.$apply(function(){b.focused=!0,b.query()})}),g.bind("blur",function(){b.$apply(function(){b.focused=!1})}),h.bind("mouseover",function(){b.$apply(function(){b.mousedOver=!0})}),h.bind("mouseleave",function(){b.$apply(function(){b.mousedOver=!1})}),g.bind("keyup",function(a){(9===a.keyCode||13===a.keyCode)&&(console.log("tab/enter!"),b.$apply(function(){e.selectActive()})),27===a.keyCode&&b.$apply(function(){b.hide=!0})}),g.bind("keydown",function(a){(9===a.keyCode||13===a.keyCode||27===a.keyCode)&&a.preventDefault(),40===a.keyCode&&(console.log("down arrow!"),a.preventDefault(),b.$apply(function(){e.activateNextItem()})),38===a.keyCode&&(console.log("up arrow!"),a.preventDefault(),b.$apply(function(){e.activatePreviousItem()}))}),b.$watch("items",function(a){e.activate(a.length?a[0]:null)}),b.$watch("isVisible()",function(a){a?g&&g.length>0&&h.css({top:g.position().top+g[0].offsetHeight,left:g.position().left,position:"absolute",display:"block",width:g[0].offsetWidth}):h.css("display","none")}),b.timeout=parseInt(b.timeout),b.query=function(){b.pendingPromise&&a.cancel(b.pendingPromise),b.pendingPromise=a(function(){b.hide=!1,b.search({term:b.term})},b.timeout)}}}}]).directive("typeaheadItem",function(){return{require:"^typeahead",link:function(a,b,c,d){var e=a.$eval(c.typeaheadItem);a.$watch(function(){return d.isActive(e)},function(a){a?b.addClass("active"):b.removeClass("active")}),b.bind("mouseenter",function(){a.$apply(function(){d.activate(e)})}),b.bind("click",function(){a.$apply(function(){d.select(e)})})}}}),angular.module("profileviewerApp").filter("formatFacebookUsername",function(){return function(a){return a&&(a=a.replace(/http.*facebook.com\//,"").replace(/^facebook.com\//,"")),a.toLowerCase().match(/^[a-z\d.]{5,}$/i)?a:null}}).filter("formatGithubUsername",function(){return function(a){return a&&(a=a.replace(/http.*github.com\//,"").replace(/^github.com\//,"")),a.toLowerCase().match(/^[0-9a-z_-]+$/)?a:null}}).filter("formatTwitterUsername",function(){return function(a){return a&&(a=a.replace(/^@/,"").replace(/http.*twitter.com\//,"").replace(/^twitter.com\//,"")),a.toLowerCase().match(/^[0-9a-z_]+$/)?a:null}}).filter("formatDomain",function(){function a(a){var b=document.createElement("a");return b.href=a,b.hostname}return function(b){if(b){var c=a(b);return c.replace("www.","")}return null}}),angular.module("profileviewerApp").controller("MainCtrl",["$scope","Person","Utils",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.featuredFriends=[{username:"gavin",avatarUrl:"https://s3.amazonaws.com/kd4/gavin"},{username:"albertwenger",avatarUrl:"https://pbs.twimg.com/profile_images/1773890030/aew_artistic_bigger.gif"},{username:"fredwilson",avatarUrl:"https://s3.amazonaws.com/65m/fredwilson-avatar.jpg"},{username:"muneeb",avatarUrl:"https://s3.amazonaws.com/kd4/muneeb"},{username:"naval",avatarUrl:"https://pbs.twimg.com/profile_images/3696617328/667874c5936764d93d56ccc76a2bcc13.jpeg"},{username:"arianna",avatarUrl:"https://s3.amazonaws.com/97p/ariannas-profile.jpg"},{username:"ryanshea",avatarUrl:"https://s3.amazonaws.com/97p/tux.jpg"}];for(var d=0;d<a.featuredFriends.length;d++)c.loadAvatar(a.featuredFriends[d].avatarUrl,"friend-avatar-"+d,100)}]),angular.module("profileviewerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("profileviewerApp").controller("ProfileCtrl",["$scope","$routeParams","Utils","Person","Samples",function(a,b,c,d,e){a.user={},a.avatarSize=200,a.friendAvatarSize=100;var f=c.hasProp,g=c.getProp;a.loadAvatar=function(a,b,c){var d=new Image;d.onload=function(){if(document.getElementById(b).appendChild(d),d.height<d.width){d.style.height="100%",d.style.width="auto";var a=-(c/d.height*d.width-c)/2;d.style.marginLeft=a.toString()+"px"}},d.src=a},a.loadBackground=function(a,b){var c=new Image;c.onload=function(){var a=document.getElementById(b);a.style.backgroundImage="url("+c.src+")",a.style.backgroundSize="cover",a.style.webkitBackgroundSize="cover",a.style.mozBackgroundSize="cover"},c.src=a},d.findByUsername(b.username,function(c){var d=[],e=[],h=[],i=[],j=null,k=null,l=null,m=null,n=null,o=0,p=null,q=null;if(f(c,"twitter","username")&&f(c,"twitter","proof","url")&&(j={type:"twitter",iconClass:"fa-twitter",username:c.twitter.username,url:"https://twitter.com/"+c.twitter.username,proofUrl:c.twitter.proof.url},d.push(j)),f(c,"facebook","username")&&f(c,"facebook","proof","url")&&(j={type:"facebook",iconClass:"fa-facebook",username:c.facebook.username,url:"https://facebook.com/"+c.facebook.username,proofUrl:c.facebook.proof.url},d.push(j)),f(c,"github","username")&&f(c,"github","proof","url")&&(j={type:"github",iconClass:"fa-github",username:c.github.username,url:"https://github.com/"+c.github.username,proofUrl:c.github.proof.url},d.push(j)),f(c,"bitcoin","address")?e.push({type:"bitcoin",identifier:c.bitcoin.address}):f(c,"bitcoin")&&e.push({type:"bitcoin",identifier:c.bitcoin}),f(c,"graph","followees")){var r=c.graph.followees,s=0,t=4;o=Object.keys(r).length;for(var u in r){var v=r[u],w=null;if(f(v,"avatar_url")&&(w=g(v,"avatar_url")),w){var x={username:u,avatarUrl:w};if(h.push(x),s+=1,o-=1,s>=t)break}}}f(c,"pgp","fingerprint")&&(m=c.pgp.fingerprint,m=m.slice(m.length-16,m.length).match(/.{1,4}/g).join(" ")),f(c,"avatar","url")?k=c.avatar.url:f(c,"avatar")&&(k=c.avatar),f(c,"cover","url")?l=c.cover.url:f(c,"cover")&&(l=c.cover),f(c,"name","formatted")?p=c.name.formatted:f(c,"name")&&(p=c.name),f(c,"location","formatted")?q=c.location.formatted:f(c,"location")&&(q=c.location),a.user={username:b.username,name:p,avatarUrl:k,backgroundUrl:l,location:q,bio:c.bio,featuredFriends:h,unfeaturedFriendCount:o,shortPgpFingerprint:m,shortOtrFingerprint:n,profiles:d,websites:i,payments:e},a.loadAvatar(a.user.avatarUrl,"user-avatar-container",a.avatarSize),a.loadBackground(a.user.backgroundUrl,"profile-bottom");for(var y=0;y<a.user.featuredFriends.length;y++)a.loadAvatar(a.user.featuredFriends[y].avatarUrl,"friend-avatar-"+y,a.friendAvatarSize)},function(){if("ryansheasample"===b.username){a.user=e.user(),a.loadAvatar(a.user.avatarUrl,"user-avatar-container",a.avatarSize),a.loadBackground(a.user.backgroundUrl,"profile-bottom");for(var c=0;c<a.user.featuredFriends.length;c++)a.loadAvatar(a.user.featuredFriends[c].avatarUrl,"friend-avatar-"+c,a.friendAvatarSize)}})}]),angular.module("profileviewerApp").controller("NavbarCtrl",["$scope","Person","Utils",function(a,b,c){var d=c.hasProp;a.search=function(c){b.search(c,function(b){var c=[];b.results&&b.results.map(function(b){var e=!1,f=!1,g=!1;(d(b,"profile","twitter","username")||d(b,"profile","github","username")||d(b,"profile","facebook","username"))&&(e=!0),a.website&&(e=!0),(d(b,"profile","twitter","proof","url")||d(b,"profile","github","proof","url")||d(b,"profile","facebook","proof","url"))&&(g=!0),d(b,"profile","name","formatted")&&(f=!0),b.username&&f&&e&&c.push(b)}),a.people=c},function(a){console.log(a)})}}]);