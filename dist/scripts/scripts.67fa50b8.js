"use strict";angular.module("profileviewerApp",["ngCookies","ngResource","ngRoute","ui.bootstrap","ngClipboard","monospaced.qrcode"]).config(["$compileProvider","$locationProvider","$routeProvider",function(a,b,c){a.aHrefSanitizationWhitelist(/^\s*(https?|file|tel|skype|mailto|callto|bitmsg|bitcoin|namecoin|litecoin|dogecoin):/),b.html5Mode(!0).hashPrefix("!"),c.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/:username",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("profileviewerApp").factory("Utils",[function(){var a={};return a.hasProp=function(a){for(var b=[].slice.call(arguments,1);a&&b.length;)a=a[b.shift()];return b.length?null:a},a.getProp=function(a){for(var b=[].slice.call(arguments,1);a&&b.length;)a=a[b.shift()];return b.length?null:a},a.loadAvatar=function(a,b,c){var d=new Image;d.onload=function(){if(document.getElementById(b).appendChild(d),d.height<d.width){d.style.height="100%",d.style.width="auto";var a=-(c/d.height*d.width-c)/2;d.style.marginLeft=a.toString()+"px"}},d.src=a},a.loadBackground=function(a,b){var c=new Image;c.onload=function(){var a=document.getElementById(b);a.style.backgroundImage="url("+c.src+")",a.style.backgroundSize="cover",a.style.webkitBackgroundSize="cover",a.style.mozBackgroundSize="cover"},c.src=a},a}]),angular.module("profileviewerApp").factory("Person",["$http","Utils",function(a,b){var c={},d=b.hasProp;return c.findByUsername=function(b,c,e){var f="http://onenameapi.herokuapp.com/users/"+b;a({method:"GET",url:f}).success(function(b){d(b,"graph","url")?a({method:"GET",url:b.graph.url}).success(function(a){b.graph=a,c(b)}).error(function(a){console.log(a)}):(b.graph={},c(b))}).error(function(a){e(a)})},c.search=function(b,c,d){if(b){if(0===b.length)return void c({results:[]});var e="http://onenameapi.herokuapp.com/search?query="+b;a({method:"GET",url:e}).success(function(a){c(a)}).error(function(a){d(a)})}},c}]),angular.module("profileviewerApp").factory("Samples",[function(){var a={};return a.user=function(){var a={username:"ryanshea",name:"Ryan Shea",contactMethods:[{type:"email",identifier:"ryan@shea.io",iconClass:"fa-envelope-o",url:"#"},{type:"phone",identifier:"5515563914",iconClass:"fa-mobile-phone",url:"#"},{type:"skype",identifier:"ryaneshea",iconClass:"fa-skype",url:"skype:ryaneshea"},{type:"bitmessage",identifier:"BM-2cSqtKVx27J8FZunKqjcsbfKQAhbgWnLdg",url:"bitmsg:BM-2cSqtKVx27J8FZunKqjcsbfKQAhbgWnLdg"}],avatarUrl:"https://s3.amazonaws.com/97p/tux.jpg",backgroundUrl:"https://s3.amazonaws.com/dx3/ryanshea",location:"New York, NY",bio:"Co-founder of Onename with @Muneeb. Bitcoin, identity, the blockchain, and decentralization.",featuredFriends:[{username:"muneeb",avatarUrl:"https://s3.amazonaws.com/kd4/muneeb"},{username:"albertwenger",avatarUrl:"https://pbs.twimg.com/profile_images/1773890030/aew_artistic_bigger.gif"},{username:"naval",avatarUrl:"https://pbs.twimg.com/profile_images/3696617328/667874c5936764d93d56ccc76a2bcc13.jpeg"},{username:"arianna",avatarUrl:"https://s3.amazonaws.com/97p/ariannas-profile.jpg"}],unfeaturedFriendCount:24,shortPgpFingerprint:"A93E A312",shortOtrFingerprint:"756C E84F",keychain:[{type:"pgp",fingerprint:"DDA1CF3D659064044EC99354429E1A42A93EA312",url:"https://s3.amazonaws.com/97p/pubkey.asc#000000000000000000"},{type:"otr",fingerprint:"756CE84F 90ABDE84 0555F4E2 E0B2ACB1 297F9E65"},{type:"bitcoin",fingerprint:"1FbynFXB1C6jSAQZivucAnzAm9N7GxURYa",value:"083a0518062cc3c5ad48501c60aa06059785449f579a256ed2f1a5e781a109d978e54b20fb43b6e90dc91d8f9898665b969e122df6e1d1e5ce06c790f618a2c4"}],payments:[{type:"bitcoin",identifier:"14eautXfJT7EZsKfm1eHSAPnHkn3w1XF9R"},{type:"namecoin",identifier:"N4izoiyX9XKapXqsts7bSN7c3Bcgnr9aeo"},{type:"dogecoin",identifier:"DMHjRxrKN48EQZQDmmoghxZPRRZrvDJeVh"},{type:"quarkcoin",identifier:""}],profiles:[{type:"twitter",iconClass:"fa-twitter",username:"ryaneshea",url:"https://twitter.com/ryaneshea",proofUrl:"https://twitter.com/ryaneshea/status/486057647808868352"},{type:"facebook",iconClass:"fa-facebook",username:"ryaneshea",url:"https://facebook.com/ryaneshea",proofUrl:"https://facebook.com/ryaneshea/posts/10152385985597713"},{type:"github",iconClass:"fa-github",username:"rxl",url:"https://github.com/rxl",proofUrl:"https://gist.github.com/rxl/9799732"},{type:"linkedin",iconClass:"fa-linkedin",username:"ryaneshea",url:"https://www.linkedin.com/in/ryaneshea",proofUrl:"https://www.linkedin.com"},{type:"instagram",iconClass:"fa-instagram",username:"ryaneshea",url:"http://instagram.com/ryaneshea",proofUrl:"http://instagram.com/ryaneshea"},{type:"reddit",iconClass:"fa-reddit",username:"ryaneshea",url:"http://www.reddit.com/user/ryaneshea/",proofUrl:"http://www.reddit.com/user/ryaneshea/"},{type:"hackernews",iconClass:"fa-hacker-news",username:"rxl",url:"https://news.ycombinator.com/user?id=rxl",proofUrl:"https://news.ycombinator.com/user?id=rxl"},{type:"stackoverflow",iconClass:"fa-stack-overflow",username:"/users/1530754/ryan",url:"http://stackoverflow.com/users/1530754/ryan",proofUrl:"http://stackoverflow.com/users/1530754/ryan"},{type:"angellist",iconClass:"fa-angellist",username:"ryanshea",url:"https://angel.co/ryanshea",proofUrl:"https://angel.co/ryanshea"},{type:"googleplus",iconClass:"fa-google-plus",username:"Ryan Shea",url:"https://plus.google.com/110166845166458482181/posts",proofUrl:"https://plus.google.com/110166845166458482181/posts"}],websites:[{type:"website dark-gradient",iconClass:"fa-link",username:"shea.io",url:"http://shea.io",proofUrl:"http://shea.io/.well-known/openname.txt"},{type:"website dark-gradient",iconClass:"fa-link",username:"onename.io",url:"https://onename.io",proofUrl:"https://onename.io/.well-known/openname.txt"}]};return a},a}]),angular.module("profileviewerApp").factory("PGPKey",["$http",function(a){var b={};return b.get=function(b,c,d){a({method:"GET",url:"https://onename.io/api/pgpkey?url="+escape(b)}).success(c).error(d)},b}]),angular.module("profileviewerApp").directive("typeahead",["$timeout",function(a){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"views/_searchbar.html",scope:{search:"&",select:"&",items:"=",term:"=",timeout:"@",placeholder:"@"},controller:["$scope",function(a){a.items=[],a.hide=!1,this.activate=function(b){a.active=b},this.activateNextItem=function(){var b=a.items.indexOf(a.active);this.activate(a.items[(b+1)%a.items.length])},this.activatePreviousItem=function(){var b=a.items.indexOf(a.active);this.activate(a.items[0===b?a.items.length-1:b-1])},this.isActive=function(b){return a.active===b},this.selectActive=function(){this.select(a.active)},this.select=function(){},a.isVisible=function(){return!a.hide&&(a.focused||a.mousedOver)}}],link:function(b,c,d,e){var f=c.find("form"),g=f.find("input"),h=c.find("> div");g.bind("focus",function(){b.$apply(function(){b.focused=!0,b.query()})}),g.bind("blur",function(){b.$apply(function(){b.focused=!1})}),h.bind("mouseover",function(){b.$apply(function(){b.mousedOver=!0})}),h.bind("mouseleave",function(){b.$apply(function(){b.mousedOver=!1})}),g.bind("keyup",function(a){(9===a.keyCode||13===a.keyCode)&&(console.log("tab/enter!"),b.$apply(function(){e.selectActive()})),27===a.keyCode&&b.$apply(function(){b.hide=!0})}),g.bind("keydown",function(a){(9===a.keyCode||13===a.keyCode||27===a.keyCode)&&a.preventDefault(),40===a.keyCode&&(console.log("down arrow!"),a.preventDefault(),b.$apply(function(){e.activateNextItem()})),38===a.keyCode&&(console.log("up arrow!"),a.preventDefault(),b.$apply(function(){e.activatePreviousItem()}))}),b.$watch("items",function(a){e.activate(a.length?a[0]:null)}),b.$watch("isVisible()",function(a){a?g&&g.length>0&&h.css({top:g.position().top+g[0].offsetHeight,left:g.position().left,position:"absolute",display:"block",width:g[0].offsetWidth}):h.css("display","none")}),b.timeout=parseInt(b.timeout),b.query=function(){b.pendingPromise&&a.cancel(b.pendingPromise),b.pendingPromise=a(function(){b.hide=!1,b.search({term:b.term})},b.timeout)}}}}]).directive("typeaheadItem",function(){return{require:"^typeahead",link:function(a,b,c,d){var e=a.$eval(c.typeaheadItem);a.$watch(function(){return d.isActive(e)},function(a){a?b.addClass("active"):b.removeClass("active")}),b.bind("mouseenter",function(){a.$apply(function(){d.activate(e)})}),b.bind("click",function(){a.$apply(function(){d.select(e)})})}}}),angular.module("profileviewerApp").filter("formatFacebookUsername",function(){return function(a){return a&&(a=a.replace(/http.*facebook.com\//,"").replace(/^facebook.com\//,"")),a.toLowerCase().match(/^[a-z\d.]{5,}$/i)?a:null}}).filter("formatGithubUsername",function(){return function(a){return a&&(a=a.replace(/http.*github.com\//,"").replace(/^github.com\//,"")),a.toLowerCase().match(/^[0-9a-z_-]+$/)?a:null}}).filter("formatTwitterUsername",function(){return function(a){return a&&(a=a.replace(/^@/,"").replace(/http.*twitter.com\//,"").replace(/^twitter.com\//,"")),a.toLowerCase().match(/^[0-9a-z_]+$/)?a:null}}).filter("formatDomain",function(){function a(a){var b=document.createElement("a");return b.href=a,b.hostname}return function(b){if(b){var c=a(b);return c.replace("www.","")}return null}}).filter("pgpFingerprintChunks",function(){function a(a,b,c){return c.replace(new RegExp(a,"g"),b)}return function(b,c){return b?(b=a(" ","",b),b.length>c&&(b=b.substr(b.length-c)),b.match(/.{1,4}/g)):void 0}}),angular.module("profileviewerApp").controller("MainCtrl",["$scope","Person","Utils",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.featuredFriends=[{username:"gavin",avatarUrl:"https://s3.amazonaws.com/kd4/gavin"},{username:"albertwenger",avatarUrl:"https://pbs.twimg.com/profile_images/1773890030/aew_artistic_bigger.gif"},{username:"fredwilson",avatarUrl:"https://s3.amazonaws.com/65m/fredwilson-avatar.jpg"},{username:"muneeb",avatarUrl:"https://s3.amazonaws.com/kd4/muneeb"},{username:"naval",avatarUrl:"https://pbs.twimg.com/profile_images/3696617328/667874c5936764d93d56ccc76a2bcc13.jpeg"},{username:"arianna",avatarUrl:"https://s3.amazonaws.com/97p/ariannas-profile.jpg"},{username:"ryanshea",avatarUrl:"https://s3.amazonaws.com/97p/tux.jpg"}];for(var d=0;d<a.featuredFriends.length;d++)c.loadAvatar(a.featuredFriends[d].avatarUrl,"friend-avatar-"+d,100)}]),angular.module("profileviewerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("profileviewerApp").controller("ProfileCtrl",["$scope","$routeParams","Utils","Person","Samples","$modal",function(a,b,c,d,e,f){a.user={},a.avatarSize=200,a.friendAvatarSize=100;var g=c.hasProp,h=c.getProp;d.findByUsername(b.username,function(d){var e=[],f=[],i=[],j=[],k=[],l=null,m=null,n=null,o=0,p=null,q=null;if(g(d,"twitter","username")&&g(d,"twitter","proof","url")&&(l={type:"twitter",iconClass:"fa-twitter",username:d.twitter.username,url:"https://twitter.com/"+d.twitter.username,proofUrl:d.twitter.proof.url},e.push(l)),g(d,"facebook","username")&&g(d,"facebook","proof","url")&&(l={type:"facebook",iconClass:"fa-facebook",username:d.facebook.username,url:"https://facebook.com/"+d.facebook.username,proofUrl:d.facebook.proof.url},e.push(l)),g(d,"github","username")&&g(d,"github","proof","url")&&(l={type:"github",iconClass:"fa-github",username:d.github.username,url:"https://github.com/"+d.github.username,proofUrl:d.github.proof.url},e.push(l)),g(d,"bitcoin","address")?f.push({type:"bitcoin",identifier:d.bitcoin.address}):g(d,"bitcoin")&&f.push({type:"bitcoin",identifier:d.bitcoin}),g(d,"graph","followees")){var r=d.graph.followees,s=0,t=4;o=Object.keys(r).length;for(var u in r){var v=r[u],w=null;if(g(v,"avatar_url")&&(w=h(v,"avatar_url")),w){var x={username:u,avatarUrl:w};if(i.push(x),s+=1,o-=1,s>=t)break}}}if(g(d,"pgp","fingerprint")){var y={type:"pgp",fingerprint:d.pgp.fingerprint};g(d,"pgp","url")&&(y.value=d.pgp.url),k.push(y)}g(d,"avatar","url")?m=d.avatar.url:g(d,"avatar")&&(m=d.avatar),g(d,"cover","url")?n=d.cover.url:g(d,"cover")&&(n=d.cover),g(d,"name","formatted")?p=d.name.formatted:g(d,"name")&&(p=d.name),g(d,"location","formatted")?q=d.location.formatted:g(d,"location")&&(q=d.location),a.user={username:b.username,name:p,avatarUrl:m,backgroundUrl:n,location:q,bio:d.bio,featuredFriends:i,unfeaturedFriendCount:o,profiles:e,websites:j,payments:f,keychain:k},c.loadAvatar(a.user.avatarUrl,"user-avatar-container",a.avatarSize),c.loadBackground(a.user.backgroundUrl,"profile-bottom");for(var z=0;z<a.user.featuredFriends.length;z++)c.loadAvatar(a.user.featuredFriends[z].avatarUrl,"friend-avatar-"+z,a.friendAvatarSize)},function(){if("ryansheasample"===b.username){a.user=e.user(),c.loadAvatar(a.user.avatarUrl,"user-avatar-container",a.avatarSize),c.loadBackground(a.user.backgroundUrl,"profile-bottom");for(var d=0;d<a.user.featuredFriends.length;d++)c.loadAvatar(a.user.featuredFriends[d].avatarUrl,"friend-avatar-"+d,a.friendAvatarSize)}}),a.openPaymentModal=function(b){var c=f.open({templateUrl:"/views/_sendMoneyModal.html",controller:"SendMoneyCtrl",size:b,resolve:{payments:function(){var b=[],c=["bitcoin","dogecoin","litecoin","namecoin"];for(var d in a.user.payments){var e=a.user.payments[d];e.type&&e.identifier&&-1!==c.indexOf(e.type)&&b.push(e)}return b}}});return c},a.openPublicKeyModal=function(b){var c=f.open({templateUrl:"/views/_publicKeyModal.html",controller:"PublicKeyCtrl",resolve:{publicKey:function(){var c=["pgp","otr","ssh"],d=a.user.keychain[b];return-1===c.indexOf(d.type)?null:d}}});return c},a.openFollowModal=function(){var a=f.open({templateUrl:"/views/_followModal.html",controller:"FollowModalCtrl"});return a}}]),angular.module("profileviewerApp").controller("NavbarCtrl",["$scope","Person","Utils","$modal",function(a,b,c,d){var e=c.hasProp;a.search=function(c){b.search(c,function(b){var c=[];b.results&&b.results.map(function(b){var d=!1,f=!1,g=!1;(e(b,"profile","twitter","username")||e(b,"profile","github","username")||e(b,"profile","facebook","username"))&&(d=!0),a.website&&(d=!0),(e(b,"profile","twitter","proof","url")||e(b,"profile","github","proof","url")||e(b,"profile","facebook","proof","url"))&&(g=!0),e(b,"profile","name","formatted")&&(f=!0),b.username&&f&&d&&c.push(b)}),a.people=c},function(a){console.log(a)})},a.openSignupModal=function(){var a=d.open({templateUrl:"/views/_signupModal.html",controller:"SignupModalCtrl"});return a}}]),angular.module("profileviewerApp").controller("SendMoneyCtrl",["$scope","$modalInstance","payments",function(a,b,c){a.payments=c,a.selectMethod=function(b){a.paymentIndex=b,a.address=c[b].identifier,a.paymentType=c[b].type,a.copyButtonText="Copy Address"},a.selectMethod(0),a.toggleQrcode=function(){a.qrcodeShown=a.qrcodeShown?!1:!0},a.resetAddress=function(){a.address=c[a.paymentIndex].identifier},a.getTextToCopy=function(){return a.address},a.notifyUserOfCopy=function(){a.copyButtonText="Copied!"},a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("profileviewerApp").controller("PublicKeyCtrl",["$scope","$modalInstance","publicKey","PGPKey",function(a,b,c,d){a.publicKey=c,a.publicKey.url&&d.get(c.url,function(b){a.publicKey.value=b})}]),angular.module("profileviewerApp").controller("SignupModalCtrl",["$scope",function(a){a.sites=[{name:"onename",url:"https://onename.io"},{name:"namecoin",url:"http://namecoin.info/?p=download"}]}]),angular.module("profileviewerApp").controller("FollowModalCtrl",["$scope","$modal","$modalInstance",function(a,b,c){a.openSignupModal=function(){c.dismiss("cancel");var a=b.open({templateUrl:"/views/_signupModal.html",controller:"SignupModalCtrl"});return a}}]);